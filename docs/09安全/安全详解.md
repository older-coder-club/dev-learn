# 安全面试指南（深化扩展版）

评分说明：5=必须掌握，4=很重要，3=熟练更佳，2=了解即可，1=加分项  
结构：每个条目聚焦一个知识点，使用“是什么 / 为什么 / 怎么用 / 关键细节 / 面试提示”五段，面试时便于层层下钻。避免堆砌概念，突出工程落地。  

---

## 1. OAuth2 授权码 + PKCE 流程 [4]
- 是什么：标准授权码模式（Auth Code）+ PKCE(Code Verifier + Code Challenge) 防止移动端/SPA 授权码截取。  
- 为什么：公开客户端无法安全保存客户端密钥，PKCE 增强抗拦截与重放能力。  
- 怎么用：客户端生成随机 Verifier → 派生 Challenge(SHA256/Base64URL) → 重定向到授权端 → 回调拿到 Code → 携带 Verifier 换 Token。  
- 关键细节：Challenge 方法 S256 优先；Verifier 长度与随机性；回调 URI 严格匹配。  
- 面试提示：说明“为什么移动端不放 Client Secret，PKCE 如何补位”。  

## 2. OAuth2 客户端凭证 / 刷新令牌 / 过期策略 [4]
- 是什么：Client Credentials 直接用客户端身份换取访问令牌；Refresh Token 用于长会话续期 Access Token。  
- 为什么：减少频繁登录，控制令牌短生命周期降低泄露风险。  
- 怎么用：Access Token TTL 较短（分钟级）；Refresh Token 较长（天/周）；刷新时轮换旧 Refresh 并失效处理。  
- 关键细节：刷新令牌失窃风险高；需绑定客户端、IP 或设备指纹；RBAC 改变需强制失效所有 Token。  
- 面试提示：描述“为什么 Access Token 不设置超长过期而使用双令牌”。  

## 3. OIDC 身份层与 ID Token [4]
- 是什么：OpenID Connect 在 OAuth2 基础增加 ID Token（JWT）和标准化用户信息 (Claims)。  
- 为什么：统一认证与授权，避免自行拼装身份协议。  
- 怎么用：在授权码交换加入 openid scope；校验 iss / aud / exp / nonce；可调用 UserInfo Endpoint。  
- 关键细节：ID Token 不等价访问令牌；nonce 防重放；不在前端信任未校验 Token。  
- 面试提示：清晰区分“OAuth2 授权 vs OIDC 身份”。  

## 4. JWT 结构与签名算法选择 [4]
- 是什么：Header(alg,typ) + Payload(claims) + Signature；常见 HS256(对称) / RS256(非对称)。  
- 为什么：轻量跨域传递身份与权限，避免集中 Session 存储。  
- 怎么用：后端验证签名/过期/发行方；敏感数据不置于明文 Payload；必要时加密 JWE。  
- 关键细节：alg=none 漏洞；大 Payload 带宽与缓存成本；签名秘钥与公钥轮换策略。  
- 面试提示：强调“JWT 可读不代表安全，加密与签名不同”。  

## 5. Token 撤销与黑名单 / Allow List [4]
- 是什么：对已签发尚未过期的 Token 强制失效策略。  
- 为什么：用户登出、权限收回、泄露应急。  
- 怎么用：维护撤销列表（Redis 存 jti）；或短 TTL + Refresh 轮换；敏感操作实时权限二次校验。  
- 关键细节：黑名单尺寸与过期清理；集中校验增加延迟；Allow List 用于高安全场景。  
- 面试提示：说明“为何纯 JWT 无状态难即时撤销及折衷方案”。  

## 6. 会话固定与 Cookie 安全标志 [4]
- 是什么：Session Fixation：攻击者诱导用户使用已知 Session ID；安全标志：Secure/HttpOnly/SameSite。  
- 为什么：防劫持、防脚本访问与 CSRF。  
- 怎么用：登录成功重生 Session；Cookie 设置 Secure+HttpOnly+SameSite=Lax/Strict；敏感操作同站策略。  
- 关键细节：跨子域 Cookie 范围控制；SameSite=None 需 Secure；避免在 URL 传 Session。  
- 面试提示：解释“登录后为什么要重新生成 Session ID”。  

## 7. 多因子认证 (MFA) 与风险评估 [3]
- 是什么：密码 + 第二要素(短信/OTP/硬件密钥)；风险评估基于设备/IP/行为。  
- 为什么：单因子泄露后降低被入侵概率。  
- 怎么用：低风险操作仅密码；高风险（资金）强制二次验证；异常评分触发额外挑战。  
- 关键细节：短信有劫持风险；TOTP 时钟漂移；硬件密钥抗钓鱼。  
- 面试提示：区分“持续风险评估 vs 静态 MFA”。  

## 8. SQL/NoSQL 注入防护 [4]
- 是什么：攻击者构造输入拼接查询绕过逻辑。  
- 为什么：数据泄露/破坏严重。  
- 怎么用：参数化预编译、ORM 危险 API 禁用；输入白名单枚举。  
- 关键细节：NoSQL(JSON) 注入、条件构造；LIKE 模糊需注意转义。  
- 面试提示：强调“参数化是根治手段，不依赖简单过滤”。  

## 9. XSS (存储 / 反射 / DOM) 防护 [4]
- 是什么：注入脚本在浏览器执行；分类：存储型、反射型、DOM 型。  
- 为什么：窃取 Cookie / Token / 冒充操作。  
- 怎么用：输出编码（HTML/JS/URL 上下文区分）+ CSP(默认拒绝内联脚本) + 输入语义校验。  
- 关键细节：innerHTML / v-html 等危险点；CSP 报告端点监控。  
- 面试提示：说明“为什么仅输入过滤不足以阻断所有 XSS”。  

## 10. CSRF 防护与 SameSite [4]
- 是什么：跨站请求伪造借浏览器隐式发送 Cookie 调用用户操作。  
- 为什么：可在用户不知情下转账等敏感行为。  
- 怎么用：SameSite=Lax/Strict；双提交 Cookie；CSRF Token（随机不可预测）+ Referer/Origin 校验。  
- 关键细节：仅 GET 不代表安全；JSON POST 仍需 Token；SameSite(None) 场景谨慎。  
- 面试提示：给出“支付确认为何仍需显式 Token”。  

## 11. 反序列化与 Gadget 链风险 [3]
- 是什么：不安全反序列化触发任意类加载与方法执行。  
- 为什么：可能构成 RCE。  
- 怎么用：禁用 Java 原生对象流外部输入；JSON/XML 白名单字段；库多态反序列化关闭。  
- 关键细节：升级依赖（Commons Collections 历史漏洞）；不要信任类名。  
- 面试提示：说明“为什么 prefer DTO + 显式映射”。  

## 12. SSRF 与内部资源访问防护 [3]
- 是什么：服务端从用户提供 URL 发起请求被利用访问内网/元数据。  
- 为什么：窃取内部服务数据、云元数据。  
- 怎么用：URL 解析后校验协议与 IP（禁止 127.* / 内网段）；DNS 重解析防绕过；仅允许白名单域。  
- 关键细节：重定向与 IPv6/十进制表示绕过；Gopher/telnet 协议限制。  
- 面试提示：列出“多种地址表示绕过”注意事项。  

## 13. 文件上传与路径遍历防护 [3]
- 是什么：路径遍历通过 ../ 访问越权文件；上传伪造脚本执行。  
- 为什么：可能读取敏感或执行恶意代码。  
- 怎么用：归一化路径后检查根目录前缀；保存随机文件名；单独静态域名。  
- 关键细节：MIME 与扩展名双校验；图片头签验证；限制解压文件数量。  
- 面试提示：说明“为什么不能信任客户端文件扩展名”。  

## 14. 速率限制与暴力破解防护 [4]
- 是什么：控制单 IP/账号请求频率防止密码穷举与资源耗尽。  
- 为什么：降低撞库与接口滥用。  
- 怎么用：令牌桶 + 滑动窗口；维度组合(IP+账号+设备指纹)；失败次数阈值锁定。  
- 关键细节：分布式一致性统计；避免永久锁定导致 DoS；灰度解锁。  
- 面试提示：解释“单纯按 IP 限制存在代理绕过”。  

## 15. TLS / HSTS / 加密套件选择 [3]
- 是什么：TLS 加密传输；HSTS 强制 HTTPS；AEAD(GCM/ChaCha20-Poly1305) 提供认证与保密。  
- 为什么：防中间人与窃听篡改。  
- 怎么用：禁用 TLS1.0/1.1；优先 TLS1.3；配置 HSTS(max-age, includeSubDomains)。  
- 关键细节：证书自动续期(ACME)；避免弱算法 (RC4/DES)；OCSP Stapling。  
- 面试提示：指出“仅加密不验证证书仍可被劫持”。  

## 16. mTLS 微服务内部零信任 [3]
- 是什么：双向 TLS，客户端与服务端互验证书。  
- 为什么：内部网络不再默认可信，防横向移动。  
- 怎么用：Service Mesh 或网关统一下发证书；短期证书轮换。  
- 关键细节：证书撤销/轮换自动化；性能开销评估。  
- 面试提示：说明“mTLS 与单向 TLS 差异及适用场景”。  

## 17. 数据分级与最小收集原则 [3]
- 是什么：按敏感度分类（PII/金融/日志），仅采集必要数据。  
- 为什么：减少泄露面与合规压力。  
- 怎么用：标注数据域与访问策略；审计读取；脱敏传输。  
- 关键细节：开发环境不使用生产真实数据；分级驱动加密与备份策略。  
- 面试提示：强调“默认不收集”思路。  

## 18. 密钥管理与 KMS/HSM [3]
- 是什么：集中管理密钥生命周期（生成/轮换/吊销），硬件模块防篡改。  
- 为什么：防止硬编码与泄露，支持审计。  
- 怎么用：应用通过临时凭证访问 KMS；密钥版本化；轮换策略文档化。  
- 关键细节：最小权限授予密钥使用；避免在日志输出。  
- 面试提示：说明“为何不要把加密密钥放环境变量长期不变”。  

## 19. 口令存储与 KDF (bcrypt/Argon2) [4]
- 是什么：口令通过慢哈希 + 盐存储；Argon2 支持内存难度抗 GPU。  
- 为什么：防彩虹表与暴力破解。  
- 怎么用：随机 16+ 字节盐；配置迭代/内存参数随硬件更新；不存明文。  
- 关键细节：统一升级流程；避免 SHA256 直接哈希；Pepper 服务器侧额外秘钥。  
- 面试提示：解释“为什么 bcrypt 参数需定期调高”。  

## 20. 审计日志与不可抵赖 [3]
- 是什么：对关键操作记录时间、操作者、结果、来源；不可被修改。  
- 为什么：事后追踪与合规问责。  
- 怎么用：追加写存储（append-only）+ 签名或哈希链；UTC 时间统一。  
- 关键细节：脱敏敏感字段；容量与留存周期管理。  
- 面试提示：说明“审计与普通业务日志区别”。  

## 21. RBAC 与 ABAC / 越权(IDOR) 防护 [4]
- 是什么：RBAC 角色 → 权限；ABAC 根据属性组合策略；IDOR 越权通过直接访问资源 ID。  
- 为什么：防止资源访问绕过，支持细粒度控制。  
- 怎么用：统一鉴权中间层；资源访问校验所有权；缓存策略评估。  
- 关键细节：角色爆炸处理：分层 + 属性；策略变更失效缓存。  
- 面试提示：给出“订单 ID 访问需校验用户归属”示例。  

## 22. 输入验证与统一校验链 [4]
- 是什么：多层（客户端便利 + 服务端强制 + DAO 前最终）白名单验证策略。  
- 为什么：防注入、越权、逻辑绕过。  
- 怎么用：集中 Validator + 类型转换；长度/格式/范围校验；拒绝多字节绕过。  
- 关键细节：不要依赖黑名单；编码与验证顺序；错误信息不泄露内部细节。  
- 面试提示：区分“过滤 vs 严格白名单”。  

## 23. 依赖与供应链安全 / SBOM [3]
- 是什么：软件物料清单列出所有组件与版本；扫描 CVE。  
- 为什么：快速定位漏洞影响面与升级策略。  
- 怎么用：构建流程生成 SBOM；定期 Dependency-Check；版本窗口管理。  
- 关键细节：假阴性/假阳性评估；内部私有库纳入。  
- 面试提示：说明“Log4Shell 应急排查流程”。  

## 24. API 重放 / 签名 / Nonce 防护 [4]
- 是什么：攻击者捕获请求重复发送获得重复效果或绕过时序。  
- 为什么：可能重复扣款、授权。  
- 怎么用：请求包含时间戳 + Nonce；签名(HMAC)覆盖关键字段；服务端缓存近期 Nonce。  
- 关键细节：时间窗口漂移容差；Nonce 存储过期清理。  
- 面试提示：描述“支付接口如何防重放”。  

## 25. 容器与镜像最小化 / 运行时加固 [3]
- 是什么：减少镜像层与工具；运行时非 root、只读 FS、Seccomp/AppArmor。  
- 为什么：降低攻击面与提权风险。  
- 怎么用：多阶段构建；限制 Capabilities；扫描漏洞镜像。  
- 关键细节：避免将 Secrets 打包；镜像签名验证。  
- 面试提示：说明“为什么要去掉 curl 等调试工具”。  

## 26. Secret 生命周期与动态凭证 [3]
- 是什么：从生成→分发→轮换→吊销→审计；动态短期凭证 (STS)。  
- 为什么：减少长期暴露风险。  
- 怎么用：自动轮换计划；临时令牌限时有效；集中审计访问。  
- 关键细节：轮换同步失败降级策略；禁用硬编码。  
- 面试提示：强调“静态长期密钥泄露危害”。  

## 27. 威胁建模与 STRIDE [2]
- 是什么：Spoofing/Tampering/Repudiation/Information disclosure/DoS/Elevation 六类攻击分析。  
- 为什么：系统设计阶段提前发现缺口。  
- 怎么用：数据流图 + 边界 + 资产价值评估；对每条流贴 STRIDE 分类与缓解。  
- 关键细节：定期更新模型；不只初次评审。  
- 面试提示：快速列举两个核心资产与对应威胁。  

## 28. DoS/DDoS 多层缓解 [3]
- 是什么：网络层（SYN 洪泛）、传输层、应用层高 QPS/慢请求。  
- 为什么：资源耗尽影响可用性。  
- 怎么用：前置流量清洗/CDN；连接速率限制；应用层缓存与速率策略。  
- 关键细节：慢速头攻击超时；分层指标监控。  
- 面试提示：区分“应用层与网络层防护差异”。  

## 29. 业务风控与滥用检测 [3]
- 是什么：异常行为识别（批量注册、薅羊毛、接口刷）。  
- 为什么：直接经济损失与资源浪费。  
- 怎么用：风险评分（频率/地域变动/设备指纹）；黑白名单；行为模型。  
- 关键细节：误报处理；旁路人工审核渠道。  
- 面试提示：说明“正常高频与刷接口区分因素”。  

## 30. Secret / 代码扫描与基线加固 [2]
- 是什么：静态分析(SonarQube) + Secret 扫描(trufflehog/git-secrets)；配置基线（关闭默认端口）。  
- 为什么：早期发现泄露与危险代码。  
- 怎么用：CI 集成扫描；阻断含秘钥提交；基线清单审核。  
- 关键细节：误报降低开发摩擦；定期规则更新。  
- 面试提示：举例“提交前钩子阻止硬编码凭证”。  

## 31. 加密常见误区与 IV/Nonce 管理 [2]
- 是什么：重复使用 IV/Nonce、忽略完整性(MAC)、自制算法。  
- 为什么：导致密文可被推断或篡改未检测。  
- 怎么用：库函数；随机唯一 IV；AES-GCM 自带认证；HMAC 验证。  
- 关键细节：不要重复使用 CTR/ECB；顺序：先加密后签名或用 AEAD。  
- 面试提示：说明“IV 重复的风险”。  

## 32. 密码学随机数与 SecureRandom [2]
- 是什么：SecureRandom 提供强熵；java.util.Random 不适合安全。  
- 为什么：可预测随机会被枚举或还原。  
- 怎么用：懒加载单例 SecureRandom；避免频繁阻塞熵池。  
- 关键细节：不要重置种子为低熵值；令牌长度≥128bit。  
- 面试提示：给出“Session Token 最小长度”建议。  

## 33. 面试速答锚点
1. JWT 为何不能存敏感明文：Payload 可直接 Base64 解码。  
2. CSRF 防护组合：SameSite + Token + Origin 校验。  
3. OAuth2 vs OIDC：后者增加身份层 ID Token。  
4. 幂等实现：Idempotency-Key + 幂等表 + 状态短缓存。  
5. 缓存穿透与权限：缓存未命中仍需鉴权。  
6. 注入根因：字符串拼接构造语句。  
7. XSS 核心：输出编码 + CSP。  
8. 令牌撤销：短 TTL + 黑名单补偿。  

## 34. 重要度汇总
- 认证授权/OIDC/JWT/撤销/MFA/注入/XSS/CSRF/速率限制/RBAC/输入验证/API 重放/口令存储：[4-5 核心]  
- TLS/mTLS/密钥管理/审计日志/供应链/容器加固/数据分级/缓存安全风控/DoS 减缓：[3]  
- 威胁建模/Secret 扫描/加密误区/随机数细节：[2]  

(完)