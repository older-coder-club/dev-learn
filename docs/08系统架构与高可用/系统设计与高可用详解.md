# 系统设计与高可用面试指南（深化扩展版）

评分说明：5=必须掌握，4=很重要，3=熟练更佳，2=了解即可，1=加分项  
结构说明：每个条目聚焦一个知识点，按“是什么 / 为什么 / 怎么用 / 关键细节 / 面试提示”五段展开。输出时先概念总括，再层层细化，便于面试官追问与应答结构化。

---

## 1. 高并发基础模型与容量规划 [5]

### 1.1 QPS / 并发 / 延迟分位指标
- 是什么：QPS(每秒请求数)、并发连接数、延迟分布（P50/P90/P95/P99）构成性能基线。  
- 为什么：仅看平均值会掩盖尾部长延迟导致用户体验差与线程堆积；分位数用于容量与 SLA。  
- 怎么用：压测输出完整延迟曲线；设置 SLO：P95 < 200ms、错误率 < 0.1%；根据峰值系数(峰值/均值)预留弹性容量。  
- 关键细节：尾部放大通常与资源竞争（锁/GC/IO）；P99 不稳定需收敛多样本；峰值瞬时需配合限流。  
- 面试提示：说明“为什么优化平均响应时间不等于改善用户体验”并用 P95/P99 举例。

### 1.2 同步阻塞 / 异步事件 / 批处理 / 流式模型
- 是什么：同步阻塞线程等待结果；异步事件驱动减少线程等待；批处理将任务聚合；流式持续处理数据序列。  
- 为什么：阻塞模型在高等待 IO 下浪费线程；异步与批处理提升吞吐与资源利用；流式降低端到端延迟与内存占用。  
- 怎么用：IO 密集改用异步框架（Netty）；聚合小请求批写数据库；日志/监控采用流式处理（Kafka + Flink）。  
- 关键细节：异步增加上下文传递复杂度；批量需平衡批大小与等待时间；流式需正确处理背压。  
- 面试提示：区分“提升 QPS”选择是线程池扩容还是改成异步/批处理的判断路径。

### 1.3 削峰填谷（队列 / 令牌桶）
- 是什么：通过排队或速率限制把瞬时突增平滑为稳定处理流。  
- 为什么：防止下游临时峰值压垮（数据库 / 外部接口）。  
- 怎么用：入口限流（令牌桶）+ 中间异步任务队列（MQ）；队列长度超阈值触发拒绝或降级。  
- 关键细节：队列不可无限增长；需要丢弃低价值任务策略；速率调整应基于实时消费速率。  
- 面试提示：给出“双十一峰值”如何用 MQ 平滑与限流保护下游。

### 1.4 背压（Backpressure）
- 是什么：系统在下游饱和时向上游传递产出速率降低信号。  
- 为什么：避免堆积内存膨胀与延迟失控。  
- 怎么用：队列长度、处理耗时、拒绝率触发减速；响应协议返回特定状态码 / 自定义 Header；Reactive 流请求 N 个元素。  
- 关键细节：单向限制无效；需要可观测指标闭环；阻塞式背压 vs 丢弃式策略取舍。  
- 面试提示：阐述“没有背压 → 线程池耗尽 → 超时风暴”因果链。

### 1.5 容量规划与拐点识别
- 是什么：通过压测找到吞吐随并发曲线的线性区、拐点（开始陡降）、饱和点（资源满载）。  
- 为什么：提前确定扩容阈值与性能预算避免上线后崩溃。  
- 怎么用：递增并发阶梯压测（如 STEP: 200/400/800…）记录 QPS 与 P95；定位 CPU 或 IO 饱和指标；建立容量文档。  
- 关键细节：拐点前延迟稳定、拐点后 P99 急升；混合资源瓶颈（锁竞争）需剖析 Profiling。  
- 面试提示：描述“如何判断系统瓶颈在 CPU 还是数据库”。

---

## 2. 读写分离与数据访问层扩展 [5]

### 2.1 主从复制与读写分离
- 是什么：主库处理写入，从库异步复制服务读请求。  
- 为什么：提升读吞吐并减轻主库压力。  
- 怎么用：读策略：优先从库；需最新数据时强制主读；复制延迟指标触发回退。  
- 关键细节：复制延迟导致读写不一致；需要“读己之写”会话策略；故障切换需防止双主。  
- 面试提示：说明“用户刚下单立即查看订单详情应走主库”的原因。

### 2.2 复制延迟与一致性补偿
- 是什么：主从复制存在时间差；从库落后。  
- 为什么：可能读到旧数据影响体验或业务决策。  
- 怎么用：延迟阈值（seconds_behind_master）超标→主读 / 降级；缓存版本号校验。  
- 关键细节：Binlog 网络抖动造成峰值延迟；故障恢复后回放堆积；读策略动态切换。  
- 面试提示：提供“复制延迟监控与临界值策略”说明。

### 2.3 缓存前置与多级缓存
- 是什么：本地（L1）+ 分布式（L2）+ 后端数据库三级结构。  
- 为什么：减少远程访问延迟与集中瓶颈。  
- 怎么用：本地缓存订阅失效通知（Pub/Sub）；热点 Key 预热。  
- 关键细节：一致性传播延迟；本地容量与淘汰策略；缓存雪崩防护。  
- 面试提示：解释“为什么单纯增加 Redis 节点不能解决所有延迟问题”。

### 2.4 写合并与批操作
- 是什么：多个小写请求聚合为一次批写或异步队列写。  
- 为什么：减少锁、网络与 IO 次数提升吞吐。  
- 怎么用：内存缓冲 + flush 策略（大小或时间）；数据库批量 INSERT/UPDATE。  
- 关键细节：批量窗口过大增加延迟；异常回滚需细粒度补偿；顺序需求场景慎用。  
- 面试提示：描述“高频计数写入如何批量落库”方案。

### 2.5 查询分级与冷热分层
- 是什么：访问频率不同数据分布在不同层介质（内存、SSD、S3/归档）。  
- 为什么：成本与性能平衡。  
- 怎么用：热点检测迁移至内存；老旧数据定期归档；查询路由按时间或标签。  
- 关键细节：跨层聚合需异构查询引擎；归档数据一致性与校验。  
- 面试提示：说明“海量历史订单查询加速策略”。

---

## 3. 异步化与队列削峰填谷 [5]

### 3.1 请求入队与后台消费模型
- 是什么：前端快速返回“已接收”，后台消费队列执行实际业务。  
- 为什么：缩短用户等待，提高峰值处理能力。  
- 怎么用：状态持久 + 轮询/推送查询进度；失败重试 + 死信。  
- 关键细节：使用唯一业务 ID 保证幂等；队列满时降级或拒绝。  
- 面试提示：阐述“用户提交批量导入任务”异步设计。

### 3.2 生产/消费速率匹配
- 是什么：监控生产速率与消费速率差值判断积压。  
- 为什么：持续积压表示消费能力不足或处理异常。  
- 怎么用：动态扩容消费者；开启并行处理；日志分析消费耗时。  
- 关键细节：扩容上限受下游资源约束；避免盲目增加线程。  
- 面试提示：说明“如何判断队列是否进入危险积压”。

### 3.3 超时与丢弃策略
- 是什么：超过业务价值时间的任务丢弃或降级处理。  
- 为什么：避免处理过期低价值请求占用资源。  
- 怎么用：消息携带过期时间；消费时判断 TTL；过期进入死信。  
- 关键细节：区分高价值（支付）与低价值（统计刷新）；批量过期清理。  
- 面试提示：提供“实时推荐计算超时丢弃”实例。

### 3.4 幂等处理与状态机
- 是什么：重复消息仍只作用一次；状态机记录处理阶段。  
- 为什么：网络重试与多副本重复投递常见。  
- 怎么用：幂等键 + 处理表；状态迁移（待处理→处理中→成功/失败）。  
- 关键细节：处理表需唯一约束；失败可重试需区分可重试与不可重试错误。  
- 面试提示：说明“库存扣减多次消息如何防重”。

---

## 4. 缓存与数据库一致性 / 幂等与重试策略 [5]

### 4.1 缓存更新顺序（写 DB→删缓存→延迟再删）
- 是什么：先更新数据库防止并发读取旧值回填错误，再删除缓存；延迟再删补偿竞态。  
- 为什么：降低读写交错时脏数据概率。  
- 怎么用：删除后短暂睡眠再删除；失败重试或记录补偿任务。  
- 关键细节：高并发下仍可能短窗口不一致；可加版本标记。  
- 面试提示：能够完整描述“延迟双删”步骤与适用条件。

### 4.2 Binlog 订阅修正
- 是什么：监听数据库变更事件异步刷新或删除缓存。  
- 为什么：减少缓存与数据库长期不一致风险。  
- 怎么用：Canal/CDC 服务接收 binlog → 分发处理。  
- 关键细节：事件丢失需补偿扫描；顺序保证与幂等。  
- 面试提示：回答“主动删与订阅结合的优势”。

### 4.3 缓存穿透 / 击穿 / 雪崩防护
- 是什么：穿透=访问不存在键；击穿=热点键失效瞬间高并发；雪崩=大量键同过期。  
- 为什么：导致数据库暴击或瞬时流量峰。  
- 怎么用：穿透：布隆过滤器 / 空值短 TTL；击穿：互斥锁重建 / 逻辑过期；雪崩：随机过期 + 预热 + 分批加载。  
- 关键细节：布隆误判不可避免但可调参数；互斥锁需防死锁与重建过慢。  
- 面试提示：清晰区分三者定义与解决方案。

### 4.4 幂等策略（业务唯一键 / 版本 / 重试令牌）
- 是什么：保证重复调用结果一致不破坏业务状态。  
- 为什么：重试、消息重复、网络抖动常见。  
- 怎么用：请求携带 Idempotency-Key；存结果或事务表幂等校验；版本号控制并发更新。  
- 关键细节：Key 存储过期管理；幂等逻辑不可执行副作用第二次。  
- 面试提示：举“支付确认接口”设计案例。

### 4.5 重试策略（指数退避 + 上限 + 熔断协作）
- 是什么：失败后延迟递增重试，防止集中瞬时重试风暴。  
- 为什么：缓解临时故障同时避免放大流量。  
- 怎么用：初始等待 + 乘以因子(2) + 加抖动；最大次数后转异常或死信。  
- 关键细节：不可对非幂等操作盲重试；链路传递剩余重试预算。  
- 面试提示：说明“为什么固定间隔重试不佳”。

---

## 5. 高可用与故障域设计 [4]

### 5.1 故障域与隔离
- 是什么：将系统按机架/可用区/机房划分隔离资源与风险。  
- 为什么：单域故障不应影响全部业务。  
- 怎么用：数据与副本跨域分布；路由优先本域。  
- 关键细节：跨域写一致性延迟；避免同步链路过长。  
- 面试提示：解释“机房故障对业务影响最小化策略”。

### 5.2 副本策略与 RPO/RTO
- 是什么：RPO(可容忍数据丢失时间窗口)、RTO(恢复耗时)。  
- 为什么：定义备份与恢复级别符合业务 SLA。  
- 怎么用：关键数据同步复制（低 RPO）；冷备资源更高 RTO。  
- 关键细节：同步复制增加写延迟；异步可能丢最新事务。  
- 面试提示：给出“金融交易与日志系统不同 RPO 需求”例子。

### 5.3 选主与脑裂防护
- 是什么：通过心跳与租约判定 Leader；使用多数派避免分裂。  
- 为什么：脑裂产生双写造成数据冲突。  
- 怎么用：基于 Raft/ZAB/租约；仲裁节点奇数。  
- 关键细节：网络抖动谨慎超时设置；时钟回拨影响租约。  
- 面试提示：描述“脑裂风险及检测”。

### 5.4 服务降级策略
- 是什么：在下游不可用或限流时提供简化/缓存/静态结果。  
- 为什么：保证核心路径可继续响应。  
- 怎么用：功能分级：核心、重要、非必需；非核心直接关闭或返回默认值。  
- 关键细节：降级状态需自动恢复；避免长期假数据。  
- 面试提示：说明“首页推荐不可用如何降级”。

---

## 6. 数据分片、路由与一致性哈希 [4]

### 6.1 分片键设计
- 是什么：决定数据分布的字段或组合。  
- 为什么：均衡负载与减少跨分片查询。  
- 怎么用：选择高基数稳定字段；热点拆分（userId→hash+range）。  
- 关键细节：低基数导致倾斜；分片键变更困难。  
- 面试提示：分析“按国家分片的弊端”。

### 6.2 路由策略（取模 / 范围 / 目录）
- 是什么：决定请求如何定位分片：hash取模、区间范围、目录服务映射。  
- 为什么：不同查询模式需不同路由方式。  
- 怎么用：写表维护分片映射（目录）；扩容更新映射。  
- 关键细节：取模扩容需搬迁大量数据；范围可能出现热区。  
- 面试提示：指出“目录服务”扩容优势。

### 6.3 一致性哈希与虚拟节点
- 是什么：环结构，键落在顺时针第一个节点；虚拟节点平衡分布。  
- 为什么：扩容缩容仅迁移少量键。  
- 怎么用：每物理节点配置多个虚拟节点；监控负载倾斜。  
- 关键细节：节点太少不均衡；哈希函数质量影响。  
- 面试提示：说明“为何扩容只迁移约 1/N 数据”。

### 6.4 跨分片聚合与补偿
- 是什么：在多分片上执行聚合/排序/分页需要合并结果。  
- 为什么：业务需全局视图。  
- 怎么用：并行查询各分片→合并排序→截取分页；可能使用预聚合表。  
- 关键细节：全局排序成本高；分页深处性能差。  
- 面试提示：描述“全局排行榜实现挑战”。

---

## 7. 事件驱动 / CQRS / 事件溯源 [3]

### 7.1 CQRS 读写分离
- 是什么：Command（写）模型与 Query（读）模型分离，各自优化。  
- 为什么：读写需求不同（查询聚合 vs 写一致性）。  
- 怎么用：写入事件 → 异步更新读模型投影。  
- 关键细节：投影延迟导致读非实时；需要重建能力。  
- 面试提示：说明“为什么读模型不直接写”。

### 7.2 事件溯源
- 是什么：状态由不可变事件序列派生。  
- 为什么：可审计回放、调试追踪。  
- 怎么用：事件存储 + 投影（快照加速）。  
- 关键细节：事件模式版本升级；删除/纠错需补偿事件。  
- 面试提示：谈“回放恢复错误状态”经验。

### 7.3 事件顺序与幂等
- 是什么：乱序与重复需处理，保证最终正确。  
- 为什么：分布式网络与重试导致不确定顺序。  
- 怎么用：版本号/时间戳 + 幂等去重表。  
- 关键细节：时钟不可靠；逻辑序列优先。  
- 面试提示：说明“同一对象多事件顺序错乱处理”。

---

## 8. 限流、熔断、降级与弹性策略 [5]

### 8.1 限流算法对比
- 是什么：固定窗口、滑动窗口、令牌桶（平滑）、漏桶（匀速）。  
- 为什么：防止过载与资源争抢。  
- 怎么用：分布式采用 Redis Lua 脚本；本地 + 全局组合。  
- 关键细节：滑动窗口更精确但成本高；令牌桶支持突发。  
- 面试提示：根据场景选择算法示例。

### 8.2 熔断与半开恢复
- 是什么：失败率高或慢调用触发拒绝；半开阶段尝试少量请求。  
- 为什么：阻止故障扩散并测试恢复。  
- 怎么用：窗口统计失败率；恢复后自动关闭。  
- 关键细节：区分异常类型；避免长时间熔断不测试。  
- 面试提示：画出“闭合→打开→半开”状态机。

### 8.3 降级策略
- 是什么：关闭非关键功能、返回缓存或默认值。  
- 为什么：保持核心服务可用。  
- 怎么用：功能等级划分；动态开关控制。  
- 关键细节：降级结果标记方便监控；恢复逻辑。  
- 面试提示：举例“推荐模块失败不影响下单”。

### 8.4 弹性扩缩容与预热
- 是什么：根据负载指标自动调整实例数并在上线前预热缓存。  
- 为什么：避免冷启动高延迟及资源浪费。  
- 怎么用：CPU/队列长度/响应时间触发扩容；预热热点数据。  
- 关键细节：扩容冷启动窗口；缩容需排空连接。  
- 面试提示：说明“为何需要实例预热”。

---

## 9. 统一日志、指标与追踪平台 [5]

### 9.1 结构化日志与 TraceId
- 是什么：统一 JSON 字段携带 traceId/spanId 关联分布式调用。  
- 为什么：快速定位跨服务链路问题。  
- 怎么用：入口生成 TraceId；线程池/异步上下文传播。  
- 关键细节：避免高基数字段导致存储膨胀；敏感字段脱敏。  
- 面试提示：演示“单错误日志如何还原完整链路”。

### 9.2 RED / USE 指标体系
- 是什么：RED(请求速率/错误率/持续时间)、USE(利用率/饱和度/错误)。  
- 为什么：覆盖用户体验与资源健康两个维度。  
- 怎么用：采集调用分位数；设置阈值告警。  
- 关键细节：平均值掩盖尾延迟；标签数量控制。  
- 面试提示：述“延迟突增排查优先顺序”。

### 9.3 分布式追踪采样策略
- 是什么：决定收集多少链路数据，平衡成本与可视性。  
- 为什么：全量昂贵；稀疏影响诊断。  
- 怎么用：基础采样 + 错误优先 + 慢请求强制采样。  
- 关键细节：动态调整采样率；避免丢失关键异常。  
- 面试提示：说明“如何降低追踪系统存储压力”。

### 9.4 指标与日志关联
- 是什么：通过 TraceId 或请求唯一键将高延迟指标映射到对应日志详情。  
- 为什么：缩短定位路径。  
- 怎么用：在日志中包含指标标签；可视化平台交叉查询。  
- 关键细节：保持字段命名一致；数据延迟同步。  
- 面试提示：阐述“从高 P99 到根因日志”步骤。

---

## 10. 安全与隔离策略在高可用中的作用 [3]

### 10.1 最小权限原则
- 是什么：仅授予完成任务所需最小访问权。  
- 为什么：减少被入侵后横向扩散风险。  
- 怎么用：分角色/环境隔离；审计日志。  
- 关键细节：动态权限变更同步；密钥轮换。  
- 面试提示：说明“过宽权限导致故障扩大”实例。

### 10.2 流量与环境隔离
- 是什么：生产/预发布/测试独立资源或逻辑隔离。  
- 为什么：防测试误操作影响生产。  
- 怎么用：不同 VPC、命名空间、网关策略。  
- 关键细节：避免共享数据库；数据屏蔽。  
- 面试提示：阐述“灰度流量分配策略”。

### 10.3 Bulkhead 隔离第三方依赖
- 是什么：为外部依赖分配独立线程/连接池。  
- 为什么：单依赖故障不拖垮主服务。  
- 怎么用：兼容超时与熔断。  
- 关键细节：池大小与利用率监控。  
- 面试提示：说明“单支付接口慢导致整体冻结”的防护。

---

## 11. 多活 / 灾备与容灾策略 [4]

### 11.1 多活流量路由
- 是什么：多个地域数据中心同时对外服务。  
- 为什么：降低单点故障与就近访问延迟。  
- 怎么用：全局负载均衡 + 用户地域归属优先。  
- 关键细节：数据冲突解决（版本/时间戳/业务规则）；写放大。  
- 面试提示：说明“跨区订单写入冲突处理”。

### 11.2 灾备级别（冷 / 温 / 热）
- 是什么：冷（数据备份无实时服务）、温（部分预热）、热（全量实时同步）。  
- 为什么：不同业务对恢复时间与成本要求不同。  
- 怎么用：RPO/RTO 评估；关键服务热备。  
- 关键细节：热备成本高；复制链路监控延迟。  
- 面试提示：区分三类并给出适用业务。

### 11.3 跨地域复制策略
- 是什么：异步复制降低写延迟但可能丢近期事务。  
- 为什么：长距离网络延迟不可避免。  
- 怎么用：日志流/增量复制；延迟阈值告警。  
- 关键细节：双向复制冲突；时间戳不可靠。  
- 面试提示：解释“为什么金融场景可能选择同步”。

### 11.4 健康切换与灰度验证
- 是什么：故障转移前先灰度验证新主可用性。  
- 为什么：避免错误切换扩大故障。  
- 怎么用：旁路读写测试 + 少量流量导入 → 逐步全量。  
- 关键细节：避免自动剧烈摆动；回退策略。  
- 面试提示：讲述“优雅故障转移流程”。

---

## 12. 配置与特性开关治理 [3]

### 12.1 Feature Toggle
- 是什么：在运行时开关功能控制上线与回滚。  
- 为什么：降低发布风险与支持灰度。  
- 怎么用：远程配置中心 + 缓存 + 变更审计。  
- 关键细节：过多开关导致复杂度；过期清理。  
- 面试提示：说明“快速回滚一键关闭”的价值。

### 12.2 动态配置一致性
- 是什么：实时推送新配置并保证各实例一致更新。  
- 为什么：避免配置不一致导致行为差异。  
- 怎么用：长连接推送 + 校验版本号。  
- 关键细节：失败回退上版本；签名校验。  
- 面试提示：谈“配置变更导致故障如何快速定位”。

### 12.3 审计与变更追踪
- 是什么：记录谁在何时做了什么配置修改。  
- 为什么：提升追责与溯源能力。  
- 怎么用：不可篡改日志；变更包含旧值 / 新值。  
- 关键细节：与报警系统整合；高危操作双人审核。  
- 面试提示：说明审计在安全合规中的作用。

---

## 13. 性能调优优先级与成本权衡 [4]

### 13.1 优化顺序（算法→IO→缓存→并行→JVM）
- 是什么：按影响面与投入产出比排序。  
- 为什么：避免过早微优化浪费。  
- 怎么用：先剖析热点函数与复杂度；再看 IO 合并与缓存。  
- 关键细节：盲目调 JVM 参数收益有限；数据结构选择关键。  
- 面试提示：描述一次“算法替换提升10倍”案例胜过参数调优。

### 13.2 成本与复杂度评估
- 是什么：优化收益 = 性能提升 / 维护复杂度。  
- 为什么：长期维护成本可能超过短期收益。  
- 怎么用：文档化决策；回顾实际收益。  
- 关键细节：过度分层引入调用开销；缓存一致性复杂度。  
- 面试提示：解释“未采用自定义协议优化”的原因。

### 13.3 沉没成本与微优化陷阱
- 是什么：已投入大量时间难以停止低价值优化。  
- 为什么：影响交付进度。  
- 怎么用：设立停止条件与度量指标。  
- 关键细节：避免主观“感觉快了”；基准测试。  
- 面试提示：说明从微优化抽身的决策点。

---

## 14. 热点与倾斜治理 [4]

### 14.1 热 Key 分桶
- 是什么：将单一高频 Key 拆成多 Key 分散访问。  
- 为什么：避免单点竞争。  
- 怎么用：key:base:{hash_suffix}; 聚合时合并。  
- 关键细节：桶数量与聚合成本平衡。  
- 面试提示：举“排行榜 TopN 缓存热 Key”拆分方案。

### 14.2 分片倾斜监测与迁移
- 是什么：统计各分片 QPS / 延迟检测负载不均。  
- 为什么：倾斜导致局部瓶颈。  
- 怎么用：定期采样 + 阈值触发再平衡。  
- 关键细节：迁移窗口控制；数据一致性。  
- 面试提示：说明倾斜根因（分片键分布）分析。

### 14.3 请求合并与热点保护
- 是什么：多相同查询合并下游访问（请求协同）。  
- 为什么：降低瞬时热点压力。  
- 怎么用：本地缓存 + Future 合并。  
- 关键细节：超时时间窗口选择；防止等待过度。  
- 面试提示：讲“缓存击穿时如何保护 DB”。

---

## 15. 任务调度与分布式协调 [3]

### 15.1 分布式定时唯一执行
- 是什么：确保周期任务只有一个实例执行。  
- 为什么：避免重复任务导致重复副作用。  
- 怎么用：分布式锁 / Leader 选举。  
- 关键细节：锁续租与过期处理；任务幂等。  
- 面试提示：说明“定时清理作业双重执行”风险。

### 15.2 调度漂移与时钟问题
- 是什么：因 GC / 时间回拨导致任务执行偏移。  
- 为什么：影响周期性准确性。  
- 怎么用：记录上次执行时间校正；监控偏差。  
- 关键细节：NTP 漂移报警；大 GC 暂停补偿。  
- 面试提示：举“延迟 2 分钟补偿策略”。

### 15.3 失败重试与死信分层
- 是什么：不同重试次数进入不同延迟层队列。  
- 为什么：减少即时重试冲击。  
- 怎么用：延迟队列 / DLX / 递增退避。  
- 关键细节：上限与人工介入；幂等。  
- 面试提示：描述重试 3 次后转人工流程。

---

## 16. 架构演进与分层治理 [3]

### 16.1 单体到微服务路径
- 是什么：拆分按业务域/团队边界逐步分离模块。  
- 为什么：提高独立部署与可扩展性。  
- 怎么用：识别变更频繁与耦合低的模块优先拆。  
- 关键细节：公共服务沉淀；避免过早拆分。  
- 面试提示：回答“为什么此阶段仍保留部分单体”。

### 16.2 边界判定与数据归属
- 是什么：服务拥有自己的数据模型与管理权限。  
- 为什么：减少跨边界写导致一致性复杂。  
- 怎么用：领域建模；避免共享数据库。  
- 关键细节：跨域交互用事件或 API。  
- 面试提示：说明“订单与库存边界判定”。

### 16.3 过度微服务拆分风险
- 是什么：粒度过细导致调用链长与运维复杂。  
- 为什么：性能与故障扩散风险上升。  
- 怎么用：度量调用频度 / 变更耦合度；适时合并。  
- 关键细节：服务数增长 -> 可观测性与部署成本。  
- 面试提示：举“反向合并”场景理由。

---

## 17. 观察驱动的容量与弹性策略 [4]

### 17.1 动态阈值与基线
- 是什么：基于历史分布动态计算告警阈值。  
- 为什么：减少静态阈值误报。  
- 怎么用：滑动窗口 + 标准差/百分位。  
- 关键细节：突发流量需快速调节；避免过度平滑。  
- 面试提示：说明“如何减少夜间低流量误报”。

### 17.2 异常检测（突增 / 结构变化）
- 是什么：发现与平常模式不同的流量或指标结构。  
- 为什么：提前预警潜在攻击或功能异常。  
- 怎么用：季节性模型/同比环比；多维聚合。  
- 关键细节：分类 false positive；自适应学习。  
- 面试提示：举“促销活动与攻击区分”例子。

### 17.3 自动扩缩容冷启动预热
- 是什么：新实例启动后加载必要缓存与连接。  
- 为什么：避免扩容后短期高延迟。  
- 怎么用：Warmup 请求或批量预加载。  
- 关键细节：并行预热限制资源；失败回退策略。  
- 面试提示：解释“负载瞬时上升仍延迟高”原因。

---

## 18. Chaos 工程与演练闭环 [3]

### 18.1 故障注入场景
- 是什么：模拟延迟、丢包、宕机、磁盘满、分区。  
- 为什么：验证韧性与恢复流程。  
- 怎么用：限定范围与时间；自动清理。  
- 关键细节：生产演练慎重频率；指标观察。  
- 面试提示：描述一次“网络分区演练”目标。

### 18.2 演练指标与恢复评估
- 是什么：恢复时间、错误率、降级触发率、丢数据窗口。  
- 为什么：量化韧性能力。  
- 怎么用：事前设成功判定；事后对比。  
- 关键细节：指标采集延迟；多维分析。  
- 面试提示：说明“如何判定演练成功”。

### 18.3 闭环改进与知识库
- 是什么：演练结果固化为手册与改进计划。  
- 为什么：持续提升，避免重复错误。  
- 怎么用：Root Cause → Action Items → Owner。  
- 关键细节：跟踪执行进度；优先级排序。  
- 面试提示：说明“从演练到制度化”的步骤。

---

## 19. 常见系统性故障与排错模式 [5]

### 19.1 线程池耗尽与级联阻塞
- 是什么：请求占用线程等待下游导致队列排队。  
- 为什么：超时与重试放大。  
- 怎么用：设置合理超时 + 限流 + Bulkhead。  
- 关键细节：监控拒绝数；区分 CPU vs IO 饱和。  
- 面试提示：排查路径：指标→堆栈→下游。

### 19.2 缓存雪崩与数据库打满
- 是什么：大量 Key 同期失效触发 DB 高峰。  
- 为什么：无随机过期与预热策略。  
- 怎么用：加随机 TTL + 分批重建 + 热点保护。  
- 关键细节：监控命中率趋势；提前预估失效窗口。  
- 面试提示：提供“预防动作清单”。

### 19.3 重试风暴
- 是什么：故障时海量请求无退避重试。  
- 为什么：资源耗尽延长恢复。  
- 怎么用：指数退避 + 熔断 + 最大次数。  
- 关键细节：幂等边界；错误分类。  
- 面试提示：说明“如何识别风暴起点”。

### 19.4 资源泄漏（连接 / 文件句柄）
- 是什么：未正确关闭导致池耗尽。  
- 为什么：最终触发大量失败或阻塞。  
- 怎么用：连接池超时回收；监控句柄数。  
- 关键细节：异常路径释放；压测提前发现。  
- 面试提示：谈“生产连接泄漏”实战经验。

### 19.5 悲观锁热点
- 是什么：大量请求串行等待单行锁。  
- 为什么：高并发集中在少数键。  
- 怎么用：改乐观锁 + 重试 / 分桶拆分。  
- 关键细节：冲突重试策略与重试上限。  
- 面试提示：分析“库存扣减热点行”优化。

---

## 20. 面试速答示例
1. 削峰填谷：队列异步 + 令牌桶入口限流。  
2. 缓存与 DB 一致性：更新 DB→删缓存→延迟再删 + Binlog 校准。  
3. 熔断 vs 限流：限流控制进入速率；熔断在失败占比高时快速拒绝。  
4. 一致性哈希优势：节点变更迁移少量数据，减少重平衡成本。  
5. 多活难点：跨地域写冲突与一致性补偿策略（版本/业务合并）。  

---

## 21. 重要度汇总
- 高并发模型 / 异步与削峰 / 缓存一致性 / 限流熔断降级弹性 / 可观测性 / 系统故障排错：[5]  
- 高可用副本与故障域 / 数据分片与哈希 / 性能调优与热点治理 / 灾备多活 / 观察驱动弹性：[4]  
- 事件驱动 / 配置与特性开关 / 任务调度协调 / 架构演进 / Chaos / 安全隔离基础：[3]  

(完)