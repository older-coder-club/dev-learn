# 运行与运维（DevOps / SRE）面试指南（强化版）

评分：5=必须掌握，4=很重要，3=熟练更佳，2=了解即可，1=加分项  
统一结构：是什么 / 为什么 / 怎么用 / 关键细节 / 面试提示。每条聚焦单一核心，便于面试层层下钻。

---

### 1.1 OCI 镜像结构与分层
是什么：镜像由 manifest（列出层及配置）、config（运行参数与历史）、多个 layer（压缩文件系统差异）组成。  
为什么：理解结构可优化层缓存与安全扫描；定位“某层过大”或“缓存失效”问题。  
怎么用：docker inspect 查看 config；利用 dive 或 crane 分析层大小与文件重复。  
关键细节：层不可修改只能追加；删除文件仍存在于旧层（需重构 Dockerfile）；多阶段减少最终层数量。  
面试提示：说明“为何删除文件后镜像没变小”并指出分层不可逆。

### 1.2 多阶段构建与体积瘦身
是什么：在一个 Dockerfile 中使用多个 FROM，前阶段编译/测试，后阶段仅复制必要产物。  
为什么：显著降低镜像体积与攻击面，加快拉取与部署。  
怎么用：第一阶段用完整 JDK + 构建工具，第二阶段 FROM distroless/java 或 jlink 定制运行时，只 COPY target/app.jar。  
关键细节：避免在最终阶段残留构建缓存目录/.m2；多阶段之间 COPY 注意路径；maven/gradle wrapper 缓存策略。  
面试提示：举例“由 800MB 减至 150MB”过程（剔除 JDK、测试依赖）。

### 1.3 基镜像选择与兼容性
是什么：常见基镜像：distroless（最小不可登录）、alpine（musl libc）、slim（Debian/Ubuntu裁剪）。  
为什么：错误选择导致 glibc 依赖缺失或调试困难；体积与兼容权衡。  
怎么用：需要调试工具选 slim；纯运行选 distroless；JNI/字体/时区复杂场景避免 alpine。  
关键细节：musl 与 glibc 差异导致本地编译库不可用；时区/CA 证书包是否存在；distroless 无 shell。  
面试提示：说明“为何某些 Java 服务不用 alpine”（JNI/字体/时区问题）。

### 1.4 jlink 与层化 JDK
是什么：jlink 按模块裁剪出最小运行时；官方 Java 镜像层化分离 JDK 组件。  
为什么：减少体积与冷启动时间；降低安全暴露面。  
怎么用：分析依赖模块（java.base、java.logging 等）→ jlink --add-modules 输出定制 runtime；在 Dockerfile 中直接复制定制目录。  
关键细节：需使用模块化 JAR；反射/动态加载可能缺模块；升级 JDK 需重新生成。  
面试提示：说明“jlink 对微服务镜像体积优化贡献”。

### 1.5 镜像缓存与构建顺序
是什么：构建时按指令生成层；上层变动会失效后续缓存。  
为什么：错误顺序导致频繁全量重建，增加 CI 时间。  
怎么用：先 COPY pom.xml/gradle 文件并执行依赖下载，再 COPY 源代码；将频繁变动（源）放后。  
关键细节：RUN apt-get update && apt-get install 合并避免多层；注意 apt 缓存清理。  
面试提示：描述“依赖下载缓存命中率提升构建时间从 6min 降到 2min”。

### 1.6 安全与最小权限
是什么：通过非 root 用户、只读根文件系统、剔除不必要工具减少攻击面。  
为什么：降低容器逃逸与横向移动风险；审计更简单。  
怎么用：RUN adduser -D app；USER app；挂载必要可写目录（/tmp、应用数据）；启用 --read-only。  
关键细节：端口 <1024 需特权或改高端口；只读根需单独卷存放日志；capabilities 仅保留 NET_BIND_SERVICE 等。  
面试提示：列出“三项硬化：非 root / read-only / drop capabilities”。

### 1.7 供应链安全（扫描、签名、SBOM）
是什么：识别镜像层组件漏洞（CVE）、签名保证来源、SBOM 记录依赖清单。  
为什么：防止引入高危库；满足合规与可追溯。  
怎么用：Trivy/Grype 扫描；cosign sign/verify；生成 Syft SBOM 并存档。  
关键细节：定期重新扫描已发布老镜像；多阶段编译镜像也要扫描；CI 阶段阻断高危等级。  
面试提示：说明“CVE 高于临界值自动阻断构建”策略。

### 1.8 构建确定性与复现
是什么：保证相同源码+依赖版本生成一致镜像（字节或功能）。  
为什么：排障与回滚可精准定位；合规审计。  
怎么用：锁依赖版本；禁用非确定性时间戳；记录 Git SHA/Build ID 标签；避免网络浮动资源。  
关键细节：启用 reproducible builds 需重新打包 Jar；源代码中不可用随机生成类名。  
面试提示：说明“镜像不可变 + SHA 标签”如何提升追溯性。

### 1.9 Secret 与构建参数隔离
是什么：ARG 用于构建时，ENV 用于运行时；Secret 不应进入镜像层。  
为什么：敏感值写入层会被历史记录永久保存。  
怎么用：使用 docker build --secret 或 CI 注入；运行时从外部 Secret 管理加载。  
关键细节：docker history 可看到层；无意使用 ENV 记录密钥造成泄露。  
面试提示：指出“为什么不在 Dockerfile 里写数据库密码”。

### 1.10 Rootless 与运行时资源可见性
是什么：Rootless Docker/Podman 以非特权用户运行守护进程和容器。  
为什么：进一步降低宿主机被攻破风险。  
怎么用：启用 rootless 安装；配置子 UID/GID；验证网络与端口转发。  
关键细节：性能与特性可能受限（某些 Cgroup 控制）；端口映射要求高端口。  
面试提示：说明“选择 rootless 的场景与限制”。

### 1.11 健康检测与启动优化
是什么：镜像设计影响容器启动速度与健康探针成功率。  
为什么：慢启动导致 readiness 长时间失败影响服务可用。  
怎么用：减少类加载与无关初始化；延迟非关键组件加载；配合 startupProbe。  
关键细节：避免在 ENTRYPOINT 中写复杂逻辑；谨慎使用大量反射。  
面试提示：举“启动从 40s 降至 8s”措施。

### 1.12 日志与时区/字符集配置
是什么：镜像内默认时区、字符集影响日志可读性与国际化。  
为什么：错误时区影响排障；缺少字体导致渲染或 PDF 生成失败。  
怎么用：安装 tzdata；设置 LANG/LC_ALL；只在需要时添加字体包。  
关键细节：distroless 需在上游构建时处理；过多字体膨胀体积。  
面试提示：说明“日志时区与容器调试便利性”。

### 1.13 运行命令与入口 (ENTRYPOINT/CMD)
是什么：ENTRYPOINT 定义主进程，CMD 提供默认参数。  
为什么：错误设计影响覆盖行为与信号处理。  
怎么用：ENTRYPOINT ["java","-jar","app.jar"]；CMD ["--spring.profiles.active=prod"]。  
关键细节：避免使用 shell 形式导致信号不转发；PID 1 进程需正确处理 SIGTERM。  
面试提示：解释“为什么不用 'sh -c java -jar'”。

### 1.14 信号与优雅停止
是什么：容器终止向主进程发送 SIGTERM，再超时 SIGKILL。  
为什么：需要为 Java 服务留时间完成请求与资源释放。  
怎么用：在 Dockerfile 不使用 shell 包裹；应用实现优雅关闭（Spring Boot 事件 / 自定义钩子）。  
关键细节：terminationGracePeriod 配合；阻塞或忽略 SIGTERM 会被强杀。  
面试提示：描述“优雅停机流程”展示经验。

### 1.15 分层调试与分析工具
是什么：使用 dive 或 buildkit 前端查看各层文件变动与大小。  
为什么：定位“某层巨大”或多余重复依赖。  
怎么用：运行 dive 镜像；观察文件重复；重构 Dockerfile 合并层。  
关键细节：多阶段生成中间层不出现在最终镜像；调试层大小关注 gzip 后规模。  
面试提示：说出“使用 dive 找到多余 JDK demo 文件”案例。

---

## 2. Kubernetes 核心对象与调度 深度知识点展开 [4]

### 2.1 Pod 与容器生命周期
是什么：Pod 是最小调度单元，封装一个或多个共享网络/存储的容器。  
为什么：理解 Pod 生命周期可正确处理重启、崩溃回退与状态持久化。  
怎么用：利用 InitContainer 完成依赖准备，主容器运行逻辑；Sidecar 做日志/代理。  
关键细节：Pod 不是长久单实例；重启策略 RestartPolicy（Always/OnFailure/Never）影响 Job 行为。  
面试提示：说明“Pod 重启不等于容器内状态持久”。

### 2.2 ReplicaSet 与 Deployment
是什么：ReplicaSet 保证副本数，Deployment 封装滚动升级与版本记录。  
为什么：管理无状态应用弹性与发布安全。  
怎么用：设置 strategy（RollingUpdate: maxSurge/maxUnavailable）；版本回滚 kubectl rollout undo。  
关键细节：直接修改 ReplicaSet 不推荐；Deployment 记录 revision；金丝雀可并行两个 Deployment。  
面试提示：描述“滚动升级参数作用”。

### 2.3 StatefulSet 与有状态标识
是什么：提供稳定网络标识与有序部署（pod-0, pod-1），支持持久卷模板。  
为什么：数据库、队列等需要固定身份和数据持久。  
怎么用：创建 Headless Service；使用 volumeClaimTemplates；控制更新策略（OnDelete/RollingUpdate）。  
关键细节：删除 Pod 不会重排序号；扩容新增末尾编号；滚动更新需考虑数据复制。  
面试提示：举“Kafka/ZK 使用 StatefulSet”原因。

### 2.4 DaemonSet 系统级部署
是什么：保证每个或指定节点上运行一个 Pod。  
为什么：日志采集、节点监控、网络插件需要节点常驻。  
怎么用：容忍特定污点部署到系统节点；更新版本滚动。  
关键细节：节点加入自动部署；删除 DaemonSet Pod 不会影响副本总逻辑。  
面试提示：给“节点级 agent”场景。

### 2.5 Job 与 CronJob
是什么：Job 负责一次性或并行批处理；CronJob 定时调度创建 Job。  
为什么：数据离线处理与计划任务自动化。  
怎么用：设置 backoffLimit 重试；并行设置 completions & parallelism；Cron 表达式调度。  
关键细节：失败重试可能产生重复副作用；旧版 CronJob 控制器差异；时区统一。  
面试提示：谈“幂等性保证批任务安全”。

### 2.6 Service 类型与发现
是什么：抽象访问稳定虚拟 IP：ClusterIP、NodePort、LoadBalancer、Headless。  
为什么：解耦客户端与 Pod 动态变化；提供负载均衡。  
怎么用：内部调用使用 ClusterIP；外部暴露 NodePort/LoadBalancer；Headless 与 StatefulSet 直连。  
关键细节：SessionAffinity；ExternalTrafficPolicy=Local 保留源 IP；Headless 返回各 Pod A 记录。  
面试提示：解释“Headless 作用与场景”。

### 2.7 Ingress 与 Gateway
是什么：Ingress 控制 Layer7 路由与 TLS；Gateway API 新一代规范更可扩展。  
为什么：集中管理域名、路径、证书与规则。  
怎么用：定义 IngressClass；配置 cert-manager 自动签发；或使用 Gateway CRD。  
关键细节：Nginx vs Traefik vs Istio ingress 行为差异；TLS 终止与后端加密。  
面试提示：比较“Ingress 与 Service NodePort 差异”。

### 2.8 ConfigMap / Secret / Downward API
是什么：配置（非敏感）与敏感数据分离；Downward API 注入自身元数据。  
为什么：避免重新构建镜像即可变更配置；安全隔离。  
怎么用：envFrom、volumeMount 挂载；更新 ConfigMap 与滚动触发。  
关键细节：Secret base64 仅编码非加密；热更新需 Sidecar 或轮询；Hash 注入实现自动重启。  
面试提示：说明“如何通过配置哈希触发滚动更新”。

### 2.9 Resource Requests / Limits 与 QoS
是什么：Requests = 调度保证；Limits = 上界；决定 QoS 类别。  
为什么：合适请求避免资源碎片；限制防止失控。  
怎么用：基于历史峰值设置 Requests；Limits 高于或等于请求；监控 throttling。  
关键细节：Guaranteed 不易被驱逐；BestEffort 最先驱逐；CPU 超限导致 CFS throttle。  
面试提示：给“设置不当导致频繁驱逐”案例。

### 2.10 HPA / VPA / Cluster Autoscaler
是什么：HPA 横向扩容 Pod；VPA 建议或调整资源；Cluster Autoscaler 扩缩节点。  
为什么：自动应对负载变化，提升资源利用率。  
怎么用：HPA 引入自定义指标（Prometheus Adapter）；VPA 在观察模式提供建议；节点不足触发扩容。  
关键细节：HPA 与 VPA 同时直接写入可能冲突（通常 VPA 使用推荐模式）；突发流量冷启动延迟。  
面试提示：说明“组合策略防止过度或不足扩容”。

### 2.11 Probes：liveness / readiness / startup
是什么：liveness 检测是否需重启；readiness 是否对外提供流量；startup 解决慢启动误判。  
为什么：区分“崩溃需重启”与“暂时未准备”。  
怎么用：HTTP/TCP/Exec；设置初始延迟与超时；慢加载用 startupProbe。  
关键细节：错误探针导致重启风暴；readiness 失败不重启只摘除流量。  
面试提示：解释“为什么加 startupProbe 后稳定”。

### 2.12 优雅终止与滚动升级
是什么：在终止信号后给应用清理与完成处理时间。  
为什么：避免连接半途断开与数据不一致。  
怎么用：preStop 钩子关闭连接池；terminationGracePeriodSeconds 设足够时间。  
关键细节：Deployment maxSurge/maxUnavailable 与 readiness 协同；强制超时会 SIGKILL。  
面试提示：说出“升级不中断请求”步骤。

### 2.13 Affinity / AntiAffinity / TopologySpread
是什么：亲和/反亲和基于标签控制调度；拓扑分布约束跨区域/节点均衡。  
为什么：防止同一节点集中导致单点风险。  
怎么用：podAntiAffinity 分散副本；TopologySpreadConstraints 设置 maxSkew。  
关键细节：复杂亲和影响调度性能；拓扑约束更高效。  
面试提示：说明“提升多 AZ 容错”的策略。

### 2.14 Taints & Tolerations
是什么：Taint 给节点标记“拒绝类别”，仅 Toleration 的 Pod 能调度。  
为什么：实现隔离、专用硬件或污点节点排除。  
怎么用：节点打 taint；关键组件 Pod 加 tolerations。  
关键细节：NoSchedule/PreferNoSchedule/NoExecute 不同语义；配合 PriorityClass。  
面试提示：举“GPU 节点隔离”案例。

### 2.15 PodDisruptionBudget (PDB)
是什么：限制主动中断（升级、缩容）时可同时不可用的 Pod 数或最小可用数。  
为什么：保证高可用服务在维护中保持 SLA。  
怎么用：配置 minAvailable 或 maxUnavailable；滚动升级遵守。  
关键细节：不影响节点故障等非自愿驱逐；过严 PDB 可能阻塞升级。  
面试提示：说明“为何升级卡住与 PDB 设置关系”。

### 2.16 PriorityClass 与抢占
是什么：分配优先级，资源不足时高优先级 Pod 可抢占低优先级。  
为什么：保证关键系统在压力下仍能调度。  
怎么用：定义 PriorityClass；关键组件引用。  
关键细节：抢占会驱逐低优先级；需监控影响范围。  
面试提示：谈“关键日志链路保留”的实现。

### 2.17 调度器工作流程
是什么：Filter → Score → Bind 三阶段；可扩展调度插件。  
为什么：理解失败原因（Unschedulable）。  
怎么用：kubectl describe pod 查看事件；分析具体资源或约束。  
关键细节：资源碎片造成 requests 匹配失败；亲和规则过多放慢评分。  
面试提示：解释“为什么 Pod Pending 且节点资源看似足够”。

### 2.18 驱逐与资源压力 (Eviction)
是什么：节点资源压力下按优先级与 QoS 驱逐 Pod。  
为什么：避免系统级崩溃；保留关键服务。  
怎么用：监控 node conditions（MemoryPressure、DiskPressure）；优化 Pod requests。  
关键细节：BestEffort 最先驱逐；临界阈值由 kubelet 配置。  
面试提示：说明“频繁驱逐根因：设置不合理或内存泄漏”。

### 2.19 SecurityContext 与 Pod 安全
是什么：控制容器权限 (runAsNonRoot, fsGroup, capabilities)。  
为什么：降低攻击面；符合合规。  
怎么用：去除不必要 capabilities；只读文件系统。  
关键细节：rootfs 只读需额外卷；fsGroup 影响共享卷权限。  
面试提示：列出“cap drop NET_RAW”示例。

### 2.20 CNI / 网络策略 (NetworkPolicy)
是什么：CNI 插件提供 Pod 网络；NetworkPolicy 基于标签限制流量。  
为什么：默认全互通不安全；需要最小权限网格。  
怎么用：Calico/Cilium 等；定义 ingress/egress 策略。  
关键细节：策略默认拒绝需补充必要白名单；DNS Pod 访问放行。  
面试提示：说明“东西向流量控制”价值。

### 2.21 Sidecar / Init / Ephemeral 容器
是什么：Sidecar 与主容器同生命周期；Init 顺序执行前置；Ephemeral 用于临时调试。  
为什么：分离职责（日志、代理）与快速排障。  
怎么用：Init 下载配置；Sidecar 做代理/metrics；Ephemeral 注入调试工具。  
关键细节：Sidecar 退出可能影响主容器（取决 readiness）；Ephemeral 不持久。  
面试提示：举“Envoy 作为 Sidecar”例子。

### 2.22 日志与指标集成
是什么：采集容器标准输出与指标暴露 /metrics。  
为什么：统一可观测性与弹性。  
怎么用：DaemonSet 安装日志收集器；ServiceMonitor 自动抓取。  
关键细节：stdout/stderr 行缓冲；大日志影响 IO。  
面试提示：回答“为何使用 stdout 而非写文件”。

### 2.23 升级策略与金丝雀
是什么：通过分批与标签选择子集流量验证新版本。  
为什么：降低缺陷影响范围。  
怎么用：Deployment 分两个版本 + Service 按标签筛选；外部负载均衡分权重。  
关键细节：保证监控区分版本；自动回滚阈值。  
面试提示：说明“延迟与错误双指标触发回滚”。

### 2.24 常见调度失败排查
是什么：Pod 一直 Pending。  
为什么：资源不足、亲和冲突、污点、PDB 抑制。  
怎么用：kubectl describe、调度日志、减小 requests、移除冲突约束。  
关键细节：资源碎片不是总量问题而是单节点匹配失败。  
面试提示：展示“定位 Pending”流程。

### 2.25 集群扩容与成本控制
是什么：节点自动扩容与副本调整匹配负载；避免闲置。  
为什么：节约成本并保持性能。  
怎么用：Cluster Autoscaler + HPA；观察利用率指标；使用 Spot 节省开销。  
关键细节：缩容需确保无关键 Pod；PodDisruptionBudget 影响速度。  
面试提示：说明“CPU 利用率稳定在 55~65% 是合理窗口”。

## 3. 资源管理与容量规划 [4]
是什么：为应用分配 CPU/内存 Requests（保证调度）与 Limits（上界约束）并预估扩容阈值。  
为什么：不规划导致 OOM/争抢或资源闲置成本高；过度限额引发频繁抢占与 throttling。  
怎么用：收集过去峰值（P95/P99）+ 业务增长系数；QPS→线程/连接数→内存与 CPU；预留安全缓冲（例如峰值×1.2）；HPA 基于 CPU/自定义指标扩缩容。  
关键细节：CPU 过限触发 CFS throttling 延迟升高；内存超限杀死 Pod；单节点资源碎片造成调度失败；纵向与横向扩容组合。  
面试提示：讲“QPS 转换为线程与堆内存”的计算示例显示方法论。

## 4. 监控与可观测性栈 (Metrics / Logs / Traces) [4]
是什么：Metrics（数值时间序列）、Logs（结构化事件）、Traces（分布式调用链）构成可观测性；RED（Rate/Error/Duration）、USE（Utilization/Saturation/Errors）指导监控维度。  
为什么：快速定位性能与功能故障根因；避免“只看日志”或“只看 CPU”片面。  
怎么用：按层建模：系统→运行时（GC/线程池）→业务（订单转化率）；日志加 TraceId/SpanId；链路在异步/线程池/MQ 透传上下文；指标聚合使用直方图导出 p95/p99。  
关键细节：日志过量影响 IO；分位数与平均值区别；抽样策略控制成本；分布式追踪上下文丢失常在异步执行点。  
面试提示：回答“定位延迟尖峰的三步：看分位数→追踪慢 Span→关联资源饱和”。

## 5. SLO / SLA / 错误预算 [3]
是什么：SLI（可用率、延迟、错误率测量指标）→ SLO（目标阈值，如 99.9% 可用）→ SLA（合同保证）；错误预算=允许的失败额度。  
为什么：统一风险评估与发布决策，对过度追求新功能的节奏进行约束。  
怎么用：计算周期错误预算（如月 99.9% 约 43min 容错）；预算快速消耗→暂停上线或加资源；黑白名单功能差异化保障。  
关键细节：SLO 不等于监控报警阈值；必须可测与可归因；减少指标膨胀只保留关键 SLI。  
面试提示：能算出“99.95% 月可用剩余分钟”并说明预算策略。

## 6. CI/CD 流水线治理 [4]
是什么：从代码提交到生产的自动化阶段：编译→单测→静态扫描→安全扫描→构建镜像→集成测试→部署→验证→回滚。  
为什么：降低人工操作风险与交付周期；可追溯与审计。  
怎么用：分阶段并行（单测与静态分析并行）；缓存依赖（Maven/Gradle cache）；版本不可变（Git SHA+时间戳）；部署后自动合成运行快照与健康校验；失败自动回滚。  
关键细节：构建环境隔离；Secrets 注入安全；工件签名；质量门（覆盖率、漏洞级别阈值）。  
面试提示：描述“一次提交自动到生产”关键控制点体现成熟度。

## 7. 发布策略与渐进交付 [3]
是什么：滚动（逐批替换）、蓝绿（两套环境切流）、金丝雀（小流量验证）、A/B（差异功能对比）。  
为什么：降低大版本风险；快速回退；观察指标趋势。  
怎么用：金丝雀使用单/少量 Pod；监控关键指标（错误率、P95、资源）；异常自动回滚；A/B 以用户标签分流。  
关键细节：蓝绿需双倍资源；金丝雀指标对比时注意流量基数；回滚应保持镜像不可变。  
面试提示：举“金丝雀发现延迟上升→自动回滚”案例。

## 8. 配置与密钥管理 [3]
是什么：应用参数（功能开关）、环境配置（数据库、队列）、敏感密钥（API Key、证书）分层管理与安全存储。  
为什么：错误配置导致故障；密钥泄露引发安全事件；热更新避免重启窗口。  
怎么用：使用 K8s ConfigMap / Secret 或 Vault；版本化配置（GitOps）；加密存储与最小权限访问；热刷新（监听配置中心事件）。  
关键细节：Secret 与 ConfigMap 分离；避免将敏感值写入镜像层；轮换周期与过期预警；多环境差异隔离。  
面试提示：说明“密钥轮换流程 + 自动化失效”体现成熟度。

## 9. 基础设施即代码 (IaC) [3]
是什么：用声明式/脚本定义基础设施（云资源、网络、主机配置），保证可重复与版本化；Terraform 声明式状态管理，Ansible 幂等批量操作。  
为什么：减少手工漂移；可审计与回滚；快速多环境创建。  
怎么用：模块化 Terraform；状态后端（S3+锁）；Ansible 变量分层与幂等测试；区分不可变镜像与可变配置路径。  
关键细节：并发锁避免状态冲突；敏感变量加密（Vault/Ansible Vault）；漂移检测。  
面试提示：回答“IaC 如何防止环境不一致”显示认知。

## 10. 日志与事件处理流程 [3]
是什么：结构化日志（JSON）+ 分级过滤 + 事件聚合（相同模式合并）构成低噪声告警；审计日志独立保存。  
为什么：过量日志造成 IO 压力与成本；告警风暴降低响应效率。  
怎么用：设计字段（timestamp/level/traceId/businessKey）；错误堆栈限频；集中路由到 ELK/ClickHouse；告警聚类与抑制窗口。  
关键细节：敏感数据脱敏；区分业务异常与系统错误；日志轮转与过期策略。  
面试提示：描述“减少重复告警→提高夜间值班效率”方案。

## 11. 性能与故障排查 (运行时) [4]
是什么：JVM 与 Linux 组合工具定位 CPU/G C/线程/IO 问题：jstack、jmap、JFR、async-profiler、top/iostat/vmstat/ss/strace。  
为什么：快速明确瓶颈避免盲目重启；降低 MTTR。  
怎么用：CPU 飙升→火焰图；线程阻塞→jstack 分析锁；内存泄漏→Heap Dump；FD 耗尽→lsof；网络延迟→ss/tcpdump；JFR 长期低开销采样。  
关键细节：在生产避免频繁全堆 Dump；JFR 配置事件集；strace 仅在短期诊断；工具结果与业务指标交叉验证。  
面试提示：给出“CPU 单核 100%→perf→定位自旋锁循环”路径。

## 12. 网络与协议调优基础 [3]
是什么：影响稳定与延迟的基础参数（somaxconn、rmem/wmem、TIME_WAIT、KeepAlive、TLS 握手、MTU 分片）。  
为什么：默认参数不匹配高并发长连接会导致连接耗尽、排队、重传。  
怎么用：调大 listen backlog；启用连接池；合理 KeepAlive 间隔；优化 TLS1.3；控制包大小避免分片；监控 TIME_WAIT/CLOSE_WAIT。  
关键细节：TIME_WAIT 主动关闭方；MTU 过大易分片丢包；握手缓存减少重复成本。  
面试提示：说明“大量 TIME_WAIT”缓解策略（长连接、复用）。

## 13. 安全运行时加固 [3]
是什么：最小权限与隔离：限制特权能力、减少攻击面、运行时策略（Seccomp、AppArmor、NetworkPolicy）与漏洞扫描。  
为什么：运行时突破会导致横向移动与数据泄露；镜像供应链风险。  
怎么用：禁用 root；只读根文件系统；开启 Seccomp 默认配置限制危险 syscall；NetworkPolicy 封闭非必要流量；镜像扫描与 SBOM。  
关键细节：权限漂移检测；容器逃逸路径（挂载 /var/run/docker.sock）；修复优先级按 CVSS。  
面试提示：描述“高危 syscall 阻断减少潜在逃逸面”。

## 14. 备份与灾备策略 [3]
是什么：数据保护与业务恢复方案：全量/增量备份、异地灾备、RPO（最大可接受数据丢失）与 RTO（恢复所需时间）。  
为什么：硬件故障/操作失误/勒索攻击发生时决定业务连续性。  
怎么用：关键数据库定期全量 + 频繁增量；对象存储跨区域复制；演练恢复脚本化验证；监控备份完整性。  
关键细节：备份窗口与生产负载冲突；加密与压缩平衡成本；恢复链路测试频率。  
面试提示：能清晰给出“RPO=5min，RTO=30min”与对应措施。

## 15. 事件响应与值班流程 [3]
是什么：故障分级（P0/P1/P2）、响应时限、Runbook 指导、复盘形成行动项。  
为什么：标准化减少慌乱；复盘推动系统改善。  
怎么用：接警→确认影响范围→执行 Runbook 步骤→沟通状态→恢复后复盘（事实/根因/措施/跟踪）；禁止个人指责。  
关键细节：沟通频率与模板；升级路径明确；行动项跟踪闭环。  
面试提示：描述一次“P0 API 不可用”处理流程体现成熟度。

## 16. 成本与资源优化 [2]
是什么：通过右尺寸、实例类型组合（按需/预留/Spot）、存储分层（热/冷）控制总体花费。  
为什么：资源过度预留浪费资金；缺乏优化影响扩展预算。  
怎么用：长期监控实际 vs Requests；利用自动调优或定期评审；冷热数据分层存储；Spot 对可中断任务。  
关键细节：成本指标进入看板；预留实例利用率；压缩与归档策略。  
面试提示：说明“右尺寸每月节约 X%”案例。

## 17. 灰度监控与回滚触发指标 [3]
是什么：灰度发布中实时监控关键指标并自动判定是否回滚（错误率、延迟、资源突升）。  
为什么：人工观察延迟慢；自动触发减少影响范围。  
怎么用：为金丝雀版本建立独立指标标签；设置阈值（如错误率超基线一定比例）；触发回滚脚本；黑名单快速切断异常来源。  
关键细节：基线动态 vs 固定阈值；多指标组合避免误触；回滚保证镜像不可变。  
面试提示：讲“错误率阈值 + 延迟阈值双条件回滚”策略。

## 18. 依赖管理与版本升级流程 [2]
是什么：第三方库与平台组件版本协调升级、漏洞修补与兼容性验证。  
为什么：拖延升级造成安全漏洞与技术债；一次性大跨版本风险高。  
怎么用：建立依赖清单与安全告警订阅；小步升级 + 契约测试；预生产验证；分批滚动。  
关键细节：语义化版本（MAJOR.MINOR.PATCH）；安全补丁优先；回滚策略。  
面试提示：说明“为什么分批升级比一次跳跃安全”。

## 19. 常见故障模式与应对 [4]
是什么：线程池耗尽、缓存雪崩、连接泄漏、磁盘打满、死锁、级联重试风暴。  
为什么：集中覆盖大部分线上事故类型；提前预防降低影响。  
怎么用：线程池设拒绝策略与监控；缓存过期加随机抖动 + 热点预热；连接池上限与慢查询剔除；日志轮转与容量告警；限制重试指数退避。  
关键细节：雪崩与击穿区别；连接泄漏检测（活动借出超过阈值）；磁盘打满导致写阻塞与进程异常。  
面试提示：选一个（缓存雪崩）讲防护：随机过期 + 分片 + 限流。

## 20. 面试速答示例
1. Requests 与 Limits 作用：调度保证与资源上限控制，防止抢占或 OOM。  
2. 滚动 vs 金丝雀：滚动批量替换全量；金丝雀少量流量验证指标。  
3. 线程池耗尽定位：监控活跃/队列 + jstack 看 BLOCKED/WAITING 栈。  
4. SLI vs SLO：SLI 是测量指标；SLO 是目标阈值与承诺基准。  
5. 不可变镜像好处：防配置漂移，回滚一致性，安全审计可追溯。  

## 21. 重要度汇总
- 高优先（4）：容器/K8s、监控可观测性、容量规划、CI/CD、故障模式、运行时排查  
- 中优先（3）：发布策略、配置与密钥、IaC、日志治理、网络调优、安全加固、灾备、事件响应、灰度监控  
- 了解（2）：成本优化、依赖升级  
- 必须掌握核心（5 不在此章节出现，若出现应对应团队关键 SRE 规范）  

---

### 面试回答建议结构
1. 主线：交付（CI/CD）→运行（K8s 资源与调度）→可观测（Metrics/Logs/Traces）→稳定性（SLO/错误预算）→优化与安全。  
2. 案例：从故障现象→指标→工具→根因→修复→预防，展示结构化思维。  
3. 强调工程取舍：最小镜像 vs 兼容性、金丝雀 vs 蓝绿资源占用、缓存策略 vs 一致性。  

(完)